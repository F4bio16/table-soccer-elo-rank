<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Table soccer</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.7/dist/css/autoComplete.min.css">

    <style>
      .white-box{
        background-color:rgba(255, 255, 255, 0.8);
        margin-top: 50px;
        padding: 10px 20px;
      }
      .center{
        text-align: center;
        margin-left: auto;
        margin-right: auto;
      }

      .autoComplete_wrapper>input{
        background-image: none;
      }

      .blu .autoComplete_wrapper>input{
        color: rgba(12,110,253,.5);
        border-color: rgba(12,110,253,.5)
      }
      .blu .autoComplete_wrapper>input::placeholder{
        color: rgba(12,110,253,.5);
      }

      .blu .autoComplete_wrapper>ul>li:hover{
        background-color: rgba(12,110,253,.5) !important;
      }

      .blu .autoComplete_wrapper>ul>li mark {
        color: rgba(12,110,253,1) !important;
      }

      .autoComplete_wrapper>ul>li mark {
        padding: 0 !important;
      }
    </style>
  </head>

  <body style="background-image: url('static/images/table_soccer_monk_filters2.jpg');height: 400px; background-size: cover;">
    <header class="p-3 bg-dark text-white">
      <div class="container">
        <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
          <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 px-lg-2 text-white text-decoration-none">
            <img src="static/images/logo-no-background.png" width="100px" />
          </a>
          <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
            <li><a href="{{ url_for('webclient.index') }}" class="nav-link px-2 text-white">Home</a></li>
            <li><a href="{{ url_for('webclient.player_list') }}" class="nav-link px-2 text-white">Giocatori</a></li>
            <li><a href="{{ url_for('webclient.matches_list') }}" class="nav-link px-2 text-secondary">Partite</a></li>
          </ul>
        </div>
      </div>
    </header>
    <div class="container">
      <div class="row pb-5">
        <div class="col-lg-10 offset-lg-1 white-box">
          <h2>Partite</h2>
          <table class="table table-striped table-hover">
            <thead>
              <th class="center">#</th>
              <th class="center">Squadra Blu</th>
              <th class="center" colspan="2" width="150">Score</th>
              <th class="center">Squadra Rossa</th>
            </thead>
            <tbody id="all_matches">

            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.min.js" integrity="sha384-IDwe1+LCz02ROU9k972gdyvl+AESN10+x7tBKgc9I5HFtuNz0wWnPclzo6p9vxnk" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.7/dist/autoComplete.min.js"></script>

    <script>

      const endpoint = window.location.origin + "/api/v1"

      $(document).ready(function(){

        $.support.cors = true;
        // $.cookie.json = true;

        $.ajaxSetup({
          cache: false,
          crossDomain: true,
          type: 'GET',
          contentType: 'application/json',
          dataType: 'json'
        });

        if (typeof console === "undefined" || typeof console.log === "undefined") {
          console = {};
        }

        updateLatest();

      })

      function updateLatest(){
        $.ajax({
          type: "GET",
          contentType: "application/json",
          url: endpoint + "/matches/?limit=100",
          success: function(data) {
            $latest_table = $('#all_matches')
            $latest_table.html('')
            $.each(data['matches'], function( index, value ) {

              let blue_score_colored = "<span class='badge bg-success'>"+value['blue_score']+"</span>"
              if(value['blue_score'] < value['red_score']){
                blue_score_colored = "<span class='badge bg-secondary'>"+value['blue_score']+"</span>"
              }

              let red_score_colored = "<span class='badge bg-success'>"+value['red_score']+"</span>"
              if(value['blue_score'] > value['red_score']){
                red_score_colored = "<span class='badge bg-secondary'>"+value['red_score']+"</span>"
              }

              let row = "<tr class='match_row' data-match-id="+value['id']+">\
                <td class='center'>"+value['id']+"</td>\
                <td class='center'><span class='badge bg-primary'>"+value['blue_players'][0]['name']+"</span><span class='badge bg-primary'>"+value['blue_players'][1]['name']+"</span></td>"
                if(value['state'] == "__end__"){
                  row = row + "<td style='text-align:right'>"+blue_score_colored+"</td><td style='text-align:left'>"+red_score_colored+"</td>"
                }else{
                  row = row + "<td colspan='2' class='center'><button class='btn btn-warning btn-sm add_match_result'>Inserisci risultato</button></td>"
                }
                row = row + "<td class='center'><span class='badge bg-danger'>"+value['red_players'][0]['name']+"</span><span class='badge bg-danger'>"+value['red_players'][1]['name']+"</span></td></tr>"

              $latest_table.append(row)
            });
          }
        });
      }

    </script>
  </body>
</html>

